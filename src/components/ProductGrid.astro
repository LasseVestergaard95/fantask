---
import Button from "./Button.astro";
import ProductCard from "./ProductCard.astro";

const url = "https://awccwteuyfoulnztrlsc.supabase.co/rest/v1/produkter?";
const options = {
    headers: {
        apikey:
            "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF3Y2N3dGV1eWZvdWxuenRybHNjIiwicm9sZSI6ImFub24iLCJpYXQiOjE2ODQyMzUzNzAsImV4cCI6MTk5OTgxMTM3MH0.j55yJxX0YRq2JVBAyJGzGEdMi5qoOAeM0vZNgy-y7nE"
    }
}

const response = await fetch(url, options);
const data = await response.json();

const { type } = Astro.props;

// if produkter isnt empty, filter data
const filteredData = data.filter(item => type.includes(item.type.toString()));

---
<section>
    <div class="product_grid">
        <div class="text">
            <h1>{Astro.props.titel}</h1>
            <p>{Astro.props.beskrivelse}</p>
        </div>
            <div class="grid">
                {
                    filteredData.map((product) => {
                        return <ProductCard 
                            titel={product.titel}
                            forfatter={product.forfatter}
                            img={product.img}
                            pris={product.pris}
                            type={product.type}
                            format={product.format}
                            sprog={product.sprog}
                            genre={product.genre}
                            serie={product.serie}
                            nr={product.nr}
                        />
                    })
                }
        </div>
    </div>
    <div class="button_frame">
        <Button type="secondary" link={Astro.props.kategori}>Se alt i {Astro.props.kategori}</Button>
    </div>
</section>

<style>
    
</style>